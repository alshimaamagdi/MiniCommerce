{"ast":null,"code":"import _asyncToGenerator from \"D:/Luftborn/MiniCommerce-FrontEnd-Luftborn/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { BehaviorSubject, firstValueFrom } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"angular-oauth2-oidc\";\nimport * as i2 from \"./auth-config.service\";\nexport class AuthService {\n  oauthService;\n  authConfigService;\n  ssoEnabled$ = new BehaviorSubject(false);\n  initialized = false;\n  constructor(oauthService, authConfigService) {\n    this.oauthService = oauthService;\n    this.authConfigService = authConfigService;\n  }\n  init() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      if (_this.initialized) return;\n      const config = yield firstValueFrom(_this.authConfigService.getSsoConfig());\n      _this.ssoEnabled$.next(config.enabled);\n      if (config.enabled && config.authority && config.clientId) {\n        const authConfig = {\n          issuer: config.authority,\n          clientId: config.clientId,\n          redirectUri: window.location.origin + '/index.html',\n          postLogoutRedirectUri: window.location.origin,\n          scope: 'openid profile',\n          responseType: 'code',\n          showDebugInformation: false,\n          strictDiscoveryDocumentValidation: false\n        };\n        if (config.audience) {\n          authConfig.customQueryParams = {\n            resource: config.audience\n          };\n        }\n        _this.oauthService.configure(authConfig);\n        yield _this.oauthService.loadDiscoveryDocument();\n      }\n      _this.initialized = true;\n    })();\n  }\n  get isSsoEnabled() {\n    return this.ssoEnabled$.value;\n  }\n  get isAuthenticated() {\n    return this.oauthService.hasValidAccessToken();\n  }\n  login() {\n    this.oauthService.initCodeFlow();\n  }\n  logout() {\n    this.oauthService.logOut();\n  }\n  getAccessToken() {\n    return this.oauthService.getAccessToken();\n  }\n  get claims() {\n    const claims = this.oauthService.getIdentityClaims();\n    return claims ?? {};\n  }\n  get name() {\n    const c = this.claims;\n    return c['name'] ?? c['preferred_username'] ?? '';\n  }\n  static ɵfac = function AuthService_Factory(__ngFactoryType__) {\n    return new (__ngFactoryType__ || AuthService)(i0.ɵɵinject(i1.OAuthService), i0.ɵɵinject(i2.AuthConfigService));\n  };\n  static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthService,\n    factory: AuthService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["BehaviorSubject","firstValueFrom","AuthService","oauthService","authConfigService","ssoEnabled$","initialized","constructor","init","_this","_asyncToGenerator","config","getSsoConfig","next","enabled","authority","clientId","authConfig","issuer","redirectUri","window","location","origin","postLogoutRedirectUri","scope","responseType","showDebugInformation","strictDiscoveryDocumentValidation","audience","customQueryParams","resource","configure","loadDiscoveryDocument","isSsoEnabled","value","isAuthenticated","hasValidAccessToken","login","initCodeFlow","logout","logOut","getAccessToken","claims","getIdentityClaims","name","c","i0","ɵɵinject","i1","OAuthService","i2","AuthConfigService","factory","ɵfac","providedIn"],"sources":["D:\\Luftborn\\MiniCommerce-FrontEnd-Luftborn\\src\\app\\core\\services\\auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { OAuthService } from 'angular-oauth2-oidc';\r\nimport { AuthConfig } from 'angular-oauth2-oidc';\r\nimport { AuthConfigService } from './auth-config.service';\r\nimport { BehaviorSubject, firstValueFrom } from 'rxjs';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class AuthService {\r\n  private readonly ssoEnabled$ = new BehaviorSubject<boolean>(false);\r\n  private initialized = false;\r\n\r\n  constructor(\r\n    private oauthService: OAuthService,\r\n    private authConfigService: AuthConfigService\r\n  ) {}\r\n\r\n  async init(): Promise<void> {\r\n    if (this.initialized) return;\r\n    const config = await firstValueFrom(this.authConfigService.getSsoConfig());\r\n    this.ssoEnabled$.next(config.enabled);\r\n    if (config.enabled && config.authority && config.clientId) {\r\n      const authConfig: AuthConfig = {\r\n        issuer: config.authority,\r\n        clientId: config.clientId,\r\n        redirectUri: window.location.origin + '/index.html',\r\n        postLogoutRedirectUri: window.location.origin,\r\n        scope: 'openid profile',\r\n        responseType: 'code',\r\n        showDebugInformation: false,\r\n        strictDiscoveryDocumentValidation: false,\r\n      };\r\n      if (config.audience) {\r\n        authConfig.customQueryParams = { resource: config.audience };\r\n      }\r\n      this.oauthService.configure(authConfig);\r\n      await this.oauthService.loadDiscoveryDocument();\r\n    }\r\n    this.initialized = true;\r\n  }\r\n\r\n  get isSsoEnabled(): boolean {\r\n    return this.ssoEnabled$.value;\r\n  }\r\n\r\n  get isAuthenticated(): boolean {\r\n    return this.oauthService.hasValidAccessToken();\r\n  }\r\n\r\n  login(): void {\r\n    this.oauthService.initCodeFlow();\r\n  }\r\n\r\n  logout(): void {\r\n    this.oauthService.logOut();\r\n  }\r\n\r\n  getAccessToken(): string | null {\r\n    return this.oauthService.getAccessToken();\r\n  }\r\n\r\n  get claims(): Record<string, unknown> {\r\n    const claims = this.oauthService.getIdentityClaims();\r\n    return (claims as Record<string, unknown>) ?? {};\r\n  }\r\n\r\n  get name(): string {\r\n    const c = this.claims;\r\n    return (c['name'] as string) ?? (c['preferred_username'] as string) ?? '';\r\n  }\r\n}\r\n"],"mappings":";AAIA,SAASA,eAAe,EAAEC,cAAc,QAAQ,MAAM;;;;AAGtD,OAAM,MAAOC,WAAW;EAKZC,YAAA;EACAC,iBAAA;EALOC,WAAW,GAAG,IAAIL,eAAe,CAAU,KAAK,CAAC;EAC1DM,WAAW,GAAG,KAAK;EAE3BC,YACUJ,YAA0B,EAC1BC,iBAAoC;IADpC,KAAAD,YAAY,GAAZA,YAAY;IACZ,KAAAC,iBAAiB,GAAjBA,iBAAiB;EACxB;EAEGI,IAAIA,CAAA;IAAA,IAAAC,KAAA;IAAA,OAAAC,iBAAA;MACR,IAAID,KAAI,CAACH,WAAW,EAAE;MACtB,MAAMK,MAAM,SAASV,cAAc,CAACQ,KAAI,CAACL,iBAAiB,CAACQ,YAAY,EAAE,CAAC;MAC1EH,KAAI,CAACJ,WAAW,CAACQ,IAAI,CAACF,MAAM,CAACG,OAAO,CAAC;MACrC,IAAIH,MAAM,CAACG,OAAO,IAAIH,MAAM,CAACI,SAAS,IAAIJ,MAAM,CAACK,QAAQ,EAAE;QACzD,MAAMC,UAAU,GAAe;UAC7BC,MAAM,EAAEP,MAAM,CAACI,SAAS;UACxBC,QAAQ,EAAEL,MAAM,CAACK,QAAQ;UACzBG,WAAW,EAAEC,MAAM,CAACC,QAAQ,CAACC,MAAM,GAAG,aAAa;UACnDC,qBAAqB,EAAEH,MAAM,CAACC,QAAQ,CAACC,MAAM;UAC7CE,KAAK,EAAE,gBAAgB;UACvBC,YAAY,EAAE,MAAM;UACpBC,oBAAoB,EAAE,KAAK;UAC3BC,iCAAiC,EAAE;SACpC;QACD,IAAIhB,MAAM,CAACiB,QAAQ,EAAE;UACnBX,UAAU,CAACY,iBAAiB,GAAG;YAAEC,QAAQ,EAAEnB,MAAM,CAACiB;UAAQ,CAAE;QAC9D;QACAnB,KAAI,CAACN,YAAY,CAAC4B,SAAS,CAACd,UAAU,CAAC;QACvC,MAAMR,KAAI,CAACN,YAAY,CAAC6B,qBAAqB,EAAE;MACjD;MACAvB,KAAI,CAACH,WAAW,GAAG,IAAI;IAAC;EAC1B;EAEA,IAAI2B,YAAYA,CAAA;IACd,OAAO,IAAI,CAAC5B,WAAW,CAAC6B,KAAK;EAC/B;EAEA,IAAIC,eAAeA,CAAA;IACjB,OAAO,IAAI,CAAChC,YAAY,CAACiC,mBAAmB,EAAE;EAChD;EAEAC,KAAKA,CAAA;IACH,IAAI,CAAClC,YAAY,CAACmC,YAAY,EAAE;EAClC;EAEAC,MAAMA,CAAA;IACJ,IAAI,CAACpC,YAAY,CAACqC,MAAM,EAAE;EAC5B;EAEAC,cAAcA,CAAA;IACZ,OAAO,IAAI,CAACtC,YAAY,CAACsC,cAAc,EAAE;EAC3C;EAEA,IAAIC,MAAMA,CAAA;IACR,MAAMA,MAAM,GAAG,IAAI,CAACvC,YAAY,CAACwC,iBAAiB,EAAE;IACpD,OAAQD,MAAkC,IAAI,EAAE;EAClD;EAEA,IAAIE,IAAIA,CAAA;IACN,MAAMC,CAAC,GAAG,IAAI,CAACH,MAAM;IACrB,OAAQG,CAAC,CAAC,MAAM,CAAY,IAAKA,CAAC,CAAC,oBAAoB,CAAY,IAAI,EAAE;EAC3E;;qCA7DW3C,WAAW,EAAA4C,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,YAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,iBAAA;EAAA;;WAAXjD,WAAW;IAAAkD,OAAA,EAAXlD,WAAW,CAAAmD,IAAA;IAAAC,UAAA,EADE;EAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}