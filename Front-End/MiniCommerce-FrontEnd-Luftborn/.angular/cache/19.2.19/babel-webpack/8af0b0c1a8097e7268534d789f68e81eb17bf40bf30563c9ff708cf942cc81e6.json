{"ast":null,"code":"import _asyncToGenerator from \"D:/Luftborn/MiniCommerce-FrontEnd-Luftborn/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { BehaviorSubject, firstValueFrom } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"angular-oauth2-oidc\";\nimport * as i2 from \"./auth-config.service\";\nexport class AuthService {\n  oauthService;\n  authConfigService;\n  ssoEnabled$ = new BehaviorSubject(false);\n  initialized = false;\n  constructor(oauthService, authConfigService) {\n    this.oauthService = oauthService;\n    this.authConfigService = authConfigService;\n  }\n  init() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      if (_this.initialized) return;\n      const config = yield firstValueFrom(_this.authConfigService.getSsoConfig());\n      _this.ssoEnabled$.next(config.enabled);\n      if (config.enabled && config.authority && config.clientId) {\n        const authConfig = {\n          issuer: config.authority,\n          clientId: config.clientId,\n          redirectUri: window.location.origin,\n          postLogoutRedirectUri: window.location.origin,\n          responseType: 'code',\n          scope: 'openid profile email',\n          strictDiscoveryDocumentValidation: false,\n          showDebugInformation: true\n        };\n        // optional audience\n        if (config.audience) {\n          authConfig.customQueryParams = {\n            audience: config.audience\n          };\n        }\n        _this.oauthService.configure(authConfig);\n        // ✅ best practice\n        yield _this.oa;\n      }\n    })();\n  }\n  static ɵfac = function AuthService_Factory(__ngFactoryType__) {\n    return new (__ngFactoryType__ || AuthService)(i0.ɵɵinject(i1.OAuthService), i0.ɵɵinject(i2.AuthConfigService));\n  };\n  static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthService,\n    factory: AuthService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["BehaviorSubject","firstValueFrom","AuthService","oauthService","authConfigService","ssoEnabled$","initialized","constructor","init","_this","_asyncToGenerator","config","getSsoConfig","next","enabled","authority","clientId","authConfig","issuer","redirectUri","window","location","origin","postLogoutRedirectUri","responseType","scope","strictDiscoveryDocumentValidation","showDebugInformation","audience","customQueryParams","configure","oa","i0","ɵɵinject","i1","OAuthService","i2","AuthConfigService","factory","ɵfac","providedIn"],"sources":["D:\\Luftborn\\MiniCommerce-FrontEnd-Luftborn\\src\\app\\core\\services\\auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { OAuthService, AuthConfig } from 'angular-oauth2-oidc';\r\nimport { AuthConfigService } from './auth-config.service';\r\nimport { BehaviorSubject, firstValueFrom } from 'rxjs';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class AuthService {\r\n  private readonly ssoEnabled$ = new BehaviorSubject<boolean>(false);\r\n  private initialized = false;\r\n\r\n  constructor(\r\n    private oauthService: OAuthService,\r\n    private authConfigService: AuthConfigService\r\n  ) {}\r\n\r\n  async init(): Promise<void> {\r\n    if (this.initialized) return;\r\n\r\n    const config = await firstValueFrom(\r\n      this.authConfigService.getSsoConfig()\r\n    );\r\n\r\n    this.ssoEnabled$.next(config.enabled);\r\n\r\n    if (config.enabled && config.authority && config.clientId) {\r\n\r\n      const authConfig: AuthConfig = {\r\n        issuer: config.authority,\r\n        clientId: config.clientId,\r\n\r\n        redirectUri: window.location.origin,\r\n        postLogoutRedirectUri: window.location.origin,\r\n\r\n        responseType: 'code',\r\n        scope: 'openid profile email',\r\n\r\n        strictDiscoveryDocumentValidation: false,\r\n        showDebugInformation: true,\r\n      };\r\n\r\n      // optional audience\r\n      if (config.audience) {\r\n        authConfig.customQueryParams = {\r\n          audience: config.audience,\r\n        };\r\n      }\r\n\r\n      this.oauthService.configure(authConfig);\r\n\r\n      // ✅ best practice\r\n      await this.oa\r\n"],"mappings":";AAGA,SAASA,eAAe,EAAEC,cAAc,QAAQ,MAAM;;;;AAGtD,OAAM,MAAOC,WAAW;EAKZC,YAAA;EACAC,iBAAA;EALOC,WAAW,GAAG,IAAIL,eAAe,CAAU,KAAK,CAAC;EAC1DM,WAAW,GAAG,KAAK;EAE3BC,YACUJ,YAA0B,EAC1BC,iBAAoC;IADpC,KAAAD,YAAY,GAAZA,YAAY;IACZ,KAAAC,iBAAiB,GAAjBA,iBAAiB;EACxB;EAEGI,IAAIA,CAAA;IAAA,IAAAC,KAAA;IAAA,OAAAC,iBAAA;MACR,IAAID,KAAI,CAACH,WAAW,EAAE;MAEtB,MAAMK,MAAM,SAASV,cAAc,CACjCQ,KAAI,CAACL,iBAAiB,CAACQ,YAAY,EAAE,CACtC;MAEDH,KAAI,CAACJ,WAAW,CAACQ,IAAI,CAACF,MAAM,CAACG,OAAO,CAAC;MAErC,IAAIH,MAAM,CAACG,OAAO,IAAIH,MAAM,CAACI,SAAS,IAAIJ,MAAM,CAACK,QAAQ,EAAE;QAEzD,MAAMC,UAAU,GAAe;UAC7BC,MAAM,EAAEP,MAAM,CAACI,SAAS;UACxBC,QAAQ,EAAEL,MAAM,CAACK,QAAQ;UAEzBG,WAAW,EAAEC,MAAM,CAACC,QAAQ,CAACC,MAAM;UACnCC,qBAAqB,EAAEH,MAAM,CAACC,QAAQ,CAACC,MAAM;UAE7CE,YAAY,EAAE,MAAM;UACpBC,KAAK,EAAE,sBAAsB;UAE7BC,iCAAiC,EAAE,KAAK;UACxCC,oBAAoB,EAAE;SACvB;QAED;QACA,IAAIhB,MAAM,CAACiB,QAAQ,EAAE;UACnBX,UAAU,CAACY,iBAAiB,GAAG;YAC7BD,QAAQ,EAAEjB,MAAM,CAACiB;WAClB;QACH;QAEAnB,KAAI,CAACN,YAAY,CAAC2B,SAAS,CAACb,UAAU,CAAC;QAEvC;QACA,MAAMR,KAAI,CAACsB,EAAE;MACnB;IAAC;EAAD;;qCA7Ca7B,WAAW,EAAA8B,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,YAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,iBAAA;EAAA;;WAAXnC,WAAW;IAAAoC,OAAA,EAAXpC,WAAW,CAAAqC,IAAA;IAAAC,UAAA,EADE;EAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}